<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalizadorGEO</title>
    <style>
        /* Seus estilos aqui */
    </style>
</head>
<body>
    <div class="container">
        <h1>LocalizadorGEO</h1>
        <button class="logout" onclick="logout()">Sair</button>
        
        <!-- Novas informações sobre requisições -->
        <p id="requestInfo" style="color: #333; font-size: 14px;">
            Solicitações realizadas: 0 | Limite de requisições: 100
        </p>

        <label for="campoPesquisa">Pesquisar por:</label>
        <select id="campoPesquisa">
            <!-- Suas opções aqui -->
        </select>

        <label for="valorPesquisa">Digite aqui:</label>
        <input type="text" id="valorPesquisa" placeholder="Digite o valor para pesquisar...">

        <input type="button" value="Pesquisar" id="btnPesquisar">

        <!-- Outros elementos HTML... -->

        <div id="loadingMessage" class="loading" style="display: none;"></div>

        <table id="resultadoTabela" style="display: none;">
            <!-- Sua tabela aqui -->
        </table>

        <div id="mensagemResultados" class="no-results" style="display: none;"></div>

        <input type="button" value="Mapa" id="btnMapa" style="display: none;">
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const API_KEY = 'SUA_API_KEY';
        const SPREADSHEET_ID = 'SEU_SPREADSHEET_ID';
        const RANGE = 'DADOS!A2:O';

        let worker;
        let requestCount = 0; // Variável para contar solicitações
        const requestLimit = 100; // Limite de requisições
        const requestInfoElement = document.getElementById('requestInfo'); // Elemento para mostrar as informações de requisição

        if (typeof(Worker) !== "undefined") {
            worker = new Worker("worker.js");
            worker.onmessage = function(e) {
                mostrarResultados(e.data);
            };
        }

        function atualizarInformacoesRequisicao() {
            requestInfoElement.innerText = `Solicitações realizadas: ${requestCount} | Limite de requisições: ${requestLimit}`;
        }

        function pesquisarDados() {
            if (requestCount >= requestLimit) {
                alert('Você atingiu o limite de requisições.');
                return;
            }

            const campo = document.getElementById('campoPesquisa').value;
            const valor = document.getElementById('valorPesquisa').value;

            mostrarLoading(true);
            document.getElementById('mensagemResultados').style.display = 'none';

            gapi.client.init({
                'apiKey': API_KEY,
            }).then(function () {
                return gapi.client.request({
                    'path': `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}`,
                });
            }).then(function (response) {
                requestCount++; // Incrementa o contador de requisições
                atualizarInformacoesRequisicao(); // Atualiza as informações de requisição
                const dados = response.result.values;
                worker.postMessage({dados, campo, valor});
            }, function (error) {
                console.error('Erro: ' + error.result.error.message);
                mostrarLoading(false);
            });
        }

        function mostrarResultados(resultados) {
            // Sua lógica de exibição de resultados
        }

        function mostrarLoading(exibir) {
            const loadingMessage = document.getElementById('loadingMessage');
            loadingMessage.style.display = exibir ? 'block' : 'none';

            if (exibir) {
                loadingMessage.innerHTML = 'Pesquisando.';
                let i = 0;
                loadingMessage.interval = setInterval(() => {
                    loadingMessage.innerHTML += '.';
                    if (loadingMessage.innerHTML.length > 15) {
                        loadingMessage.innerHTML = 'Pesquisando.';
                    }
                }, 1000);
            } else {
                clearInterval(loadingMessage.interval);
            }
        }

        function logout() {
            window.location.href = 'index.html';
        }

        document.getElementById('btnPesquisar').onclick = function() {
            pesquisarDados();
            this.style.width = '50%';
            document.getElementById('valorPesquisa').value = '';
        };

        worker.onmessage = function(e) {
            const limit = 30;
            const resultadosLimitados = e.data.slice(0, limit);
            mostrarResultados(resultadosLimitados);
        };
    </script>
</body>
</html>
